#!/bin/bash --login
#SBATCH -N 1
#SBATCH -n 4
#SBATCH --time=0:10:00
#SBATCH --job-name="task_5"
#SBATCH --mem-per-cpu=2G
#SBATCH --output=stdout.txt
#SBATCH --error=stderr.txt

module load intel/2022.1.2
module load quantum_espresso/7.1
#======START=====

a=5.43
alat=`echo "${a} / 0.529177" | bc -l`

cat >pw.in << EOF
 &control
    verbosity='high'
    calculation='scf'
    restart_mode='from_scratch'
    prefix='SI'
    pseudo_dir = './',
    outdir='./'
 /
 &system
    ibrav=1
    celldm(1)=${alat}
    nat=8,
    ntyp=1,
    ecutwfc = 30,
    occupations='smearing',
    degauss=0.001
 /
 &electrons
    conv_thr = 1.0e-8
    mixing_beta = 0.5
 /
 &ions
 /
ATOMIC_SPECIES
  Si  28.086  Si.pbe-mt_fhi.UPF
ATOMIC_POSITIONS  crystal
Si     0.000000    0.000000    0.000000
Si     0.000000    0.500000    0.500000
Si     0.500000    0.000000    0.500000
Si     0.500000    0.500000    0.000000
Si     0.750000    0.250000    0.750000
Si     0.250000    0.250000    0.250000
Si     0.250000    0.750000    0.750000
Si     0.750000    0.750000    0.250000
K_POINTS automatic
8 8 8 1 1 1
EOF

srun -n 4  pw.x -npools 2 <pw.in > si.out

cat >pwb.in << EOF2
 &control
    verbosity='high'
    calculation='bands'
    restart_mode='from_scratch'
    prefix='SI'
    pseudo_dir = './',
    outdir='./'
 /
 &system
    ibrav=1
    celldm(1)=${alat}
    nat=8,
    ntyp=1,
    ecutwfc = 30,
    occupations='smearing',
    degauss=0.001
 /
 &electrons
    conv_thr = 1.0e-8
    mixing_beta = 0.5
 /
 &ions
 /
ATOMIC_SPECIES
  Si  28.086  Si.pbe-mt_fhi.UPF
ATOMIC_POSITIONS  angstrom
Si     0.000000    0.000000    0.000000
Si     0.000000    0.500000    0.500000
Si     0.500000    0.000000    0.500000
Si     0.500000    0.500000    0.000000
Si     0.750000    0.250000    0.750000
Si     0.250000    0.250000    0.250000
Si     0.250000    0.750000    0.750000
Si     0.750000    0.750000    0.250000
K_POINTS 
 100
  -0.5000000   0.5000000   0.5000000 1
  -0.4888889   0.4888889   0.4888889 1
  -0.4777778   0.4777778   0.4777778 1
  -0.4666667   0.4666667   0.4666667 1
  -0.4555556   0.4555556   0.4555556 1
  -0.4444444   0.4444444   0.4444444 1
  -0.4333333   0.4333333   0.4333333 1
  -0.4222222   0.4222222   0.4222222 1
  -0.4111111   0.4111111   0.4111111 1
  -0.4000000   0.4000000   0.4000000 1
  -0.3888889   0.3888889   0.3888889 1
  -0.3777778   0.3777778   0.3777778 1
  -0.3666667   0.3666667   0.3666667 1
  -0.3555556   0.3555556   0.3555556 1
  -0.3444444   0.3444444   0.3444444 1
  -0.3333333   0.3333333   0.3333333 1
  -0.3222222   0.3222222   0.3222222 1
  -0.3111111   0.3111111   0.3111111 1
  -0.3000000   0.3000000   0.3000000 1
  -0.2888889   0.2888889   0.2888889 1
  -0.2777778   0.2777778   0.2777778 1
  -0.2666667   0.2666667   0.2666667 1
  -0.2555556   0.2555556   0.2555556 1
  -0.2444444   0.2444444   0.2444444 1
  -0.2333333   0.2333333   0.2333333 1
  -0.2222222   0.2222222   0.2222222 1
  -0.2111111   0.2111111   0.2111111 1
  -0.2000000   0.2000000   0.2000000 1
  -0.1888889   0.1888889   0.1888889 1
  -0.1777778   0.1777778   0.1777778 1
  -0.1666667   0.1666667   0.1666667 1
  -0.1555556   0.1555556   0.1555556 1
  -0.1444444   0.1444444   0.1444444 1
  -0.1333333   0.1333333   0.1333333 1
  -0.1222222   0.1222222   0.1222222 1
  -0.1111111   0.1111111   0.1111111 1
  -0.1000000   0.1000000   0.1000000 1
  -0.0888889   0.0888889   0.0888889 1
  -0.0777778   0.0777778   0.0777778 1
  -0.0666667   0.0666667   0.0666667 1
  -0.0555556   0.0555556   0.0555556 1
  -0.0444444   0.0444444   0.0444444 1
  -0.0333333   0.0333333   0.0333333 1
  -0.0222222   0.0222222   0.0222222 1
  -0.0111111   0.0111111   0.0111111 1
   0.0000000   0.0000000   0.0000000 1
  -0.0185185   0.0000000   0.0000000 1
  -0.0370370   0.0000000   0.0000000 1
  -0.0555556   0.0000000   0.0000000 1
  -0.0740741   0.0000000   0.0000000 1
  -0.0925926   0.0000000   0.0000000 1
  -0.1111111   0.0000000   0.0000000 1
  -0.1296296   0.0000000   0.0000000 1
  -0.1481481   0.0000000   0.0000000 1
  -0.1666667   0.0000000   0.0000000 1
  -0.1851852   0.0000000   0.0000000 1
  -0.2037037   0.0000000   0.0000000 1
  -0.2222222   0.0000000   0.0000000 1
  -0.2407407   0.0000000   0.0000000 1
  -0.2592593   0.0000000   0.0000000 1
  -0.2777778   0.0000000   0.0000000 1
  -0.2962963   0.0000000   0.0000000 1
  -0.3148148   0.0000000   0.0000000 1
  -0.3333333   0.0000000   0.0000000 1
  -0.3518519   0.0000000   0.0000000 1
  -0.3703704   0.0000000   0.0000000 1
  -0.3888889   0.0000000   0.0000000 1
  -0.4074074   0.0000000   0.0000000 1
  -0.4259259   0.0000000   0.0000000 1
  -0.4444444   0.0000000   0.0000000 1
  -0.4629630   0.0000000   0.0000000 1
  -0.4814815   0.0000000   0.0000000 1
  -0.5000000   0.0000000   0.0000000 1
  -0.5185185   0.0000000   0.0000000 1
  -0.5370370   0.0000000   0.0000000 1
  -0.5555556   0.0000000   0.0000000 1
  -0.5740741   0.0000000   0.0000000 1
  -0.5925926   0.0000000   0.0000000 1
  -0.6111111   0.0000000   0.0000000 1
  -0.6296296   0.0000000   0.0000000 1
  -0.6481481   0.0000000   0.0000000 1
  -0.6666667   0.0000000   0.0000000 1
  -0.6851852   0.0000000   0.0000000 1
  -0.7037037   0.0000000   0.0000000 1
  -0.7222222   0.0000000   0.0000000 1
  -0.7407407   0.0000000   0.0000000 1
  -0.7592593   0.0000000   0.0000000 1
  -0.7777778   0.0000000   0.0000000 1
  -0.7962963   0.0000000   0.0000000 1
  -0.8148148   0.0000000   0.0000000 1
  -0.8333333   0.0000000   0.0000000 1
  -0.8518519   0.0000000   0.0000000 1
  -0.8703704   0.0000000   0.0000000 1
  -0.8888889   0.0000000   0.0000000 1
  -0.9074074   0.0000000   0.0000000 1
  -0.9259259   0.0000000   0.0000000 1
  -0.9444444   0.0000000   0.0000000 1
  -0.9629630   0.0000000   0.0000000 1
  -0.9814815   0.0000000   0.0000000 1
  -1.0000000   0.0000000   0.0000000 1
EOF2
srun -n 4 pw.x -npools 2 <pwb.in > sibands.out
